<script>
  const arena  = document.getElementById("arena");
  const noBtn  = document.getElementById("noBtn");
  const yesBtn = document.getElementById("yesBtn");
  const result = document.getElementById("result");

  function rand(min, max){ return Math.random() * (max - min) + min; }
  function overlaps(a, b) {
    return !(
      a.right < b.left ||
      a.left > b.right ||
      a.bottom < b.top ||
      a.top > b.bottom
    );
  }

  // Place YES and NO side-by-side initially
  function placeButtonsSideBySide() {
    const a = arena.getBoundingClientRect();
    const gap = 14;
    const y = 70;

    const yesW = yesBtn.offsetWidth;
    const noW  = noBtn.offsetWidth;

    const total = yesW + gap + noW;
    const startX = (a.width - total) / 2;

    yesBtn.style.left = startX + "px";
    yesBtn.style.top  = y + "px";

    noBtn.style.left  = (startX + yesW + gap) + "px";
    noBtn.style.top   = y + "px";
  }

  // Move NO but NEVER allow overlap with YES
  function moveNoButton() {
    const arenaRect = arena.getBoundingClientRect();
    const yesRect   = yesBtn.getBoundingClientRect();

    const padding = 10;
    const maxX = arenaRect.width - noBtn.offsetWidth - padding;
    const maxY = arenaRect.height - noBtn.offsetHeight - padding;

    let attempts = 0;
    let placed = false;

    while (!placed && attempts < 50) {
      const x = rand(padding, maxX);
      const y = rand(30, maxY);

      noBtn.style.left = x + "px";
      noBtn.style.top  = y + "px";

      const noRect = noBtn.getBoundingClientRect();

      if (!overlaps(noRect, yesRect)) {
        placed = true;
      }

      attempts++;
    }
  }

  // Run away when cursor/finger is near NO
  const NEAR_DISTANCE = 110;

  function maybeRun(e) {
    const rect = noBtn.getBoundingClientRect();
    const cx = rect.left + rect.width / 2;
    const cy = rect.top  + rect.height / 2;

    const x = e.clientX ?? (e.touches && e.touches[0].clientX);
    const y = e.clientY ?? (e.touches && e.touches[0].clientY);
    if (x == null || y == null) return;

    if (Math.hypot(x - cx, y - cy) < NEAR_DISTANCE) {
      moveNoButton();
    }
  }

  arena.addEventListener("pointermove", maybeRun);

  noBtn.addEventListener("pointerdown", (e) => {
    e.preventDefault();
    moveNoButton();
  });

  yesBtn.addEventListener("click", () => {
    result.style.display = "block";
    noBtn.textContent = "too late ðŸ˜Œ";
    noBtn.style.opacity = "0.6";
  });

  requestAnimationFrame(placeButtonsSideBySide);
  window.addEventListener("resize", () =>
    requestAnimationFrame(placeButtonsSideBySide)
  );
</script>
